<html>

<head>
  <script src="https://cdn.pubnub.com/pubnub-dev.js"></script>
  <script src="./keys.js"></script>

<script>
function sendMessage(direction){
    currentDirection = direction;
    PUBNUB_demo.publish({
        channel: 'lego-home',
        message: {"move":direction}
      });

  }
</script>

<script>
if (!('webkitSpeechRecognition' in window)) {
  upgrade();
} else {
  console.log("voice recognition all OK...");


  var recognition = new webkitSpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = false;
  recognition.start();

  recognition.onstart = function() { }
  recognition.onresult = function(event) {
    var final_transcript = '';
       for (var i = event.resultIndex; i < event.results.length; ++i) {
         if (event.results[i].isFinal) {
           final_transcript += event.results[i][0].transcript;
         }
       }

       console.log(final_transcript);
       sendMessage(final_transcript);
     };


  recognition.onerror = function(event) {  }
  recognition.onend = function() {
  }
}
</script>
</head>
</html>
